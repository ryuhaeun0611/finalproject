import streamlit as st
import base64
from pathlib import Path

st.set_page_config(
    page_title="숲가꾸기와 산불 피해",
    layout="wide"
)

st.title("🌲 숲가꾸기 활동이 산불 피해에 미치는 영향")

# ---------------------------------------------------------
# 👥 앱 제작자
# ---------------------------------------------------------
st.markdown("""
### 👥 앱 제작자  
**20908 류지민 · 20909 류하은 · 20923 최보경**
""")

st.markdown("----")

# =========================================================
# 📌 PDF 표시 함수 (진짜 필요한 함수는 이것 하나만!)
# =========================================================
BASE_DIR = Path(__file__).parent  # main.py가 있는 폴더

def display_pdf_from_local(rel_path: str, title: str, height: int = 700):
    """리포지토리 내부 PDF를 iframe으로 띄우는 안전한 함수"""
    pdf_path = BASE_DIR / rel_path

    st.subheader(title)
    st.caption(f"`{rel_path}` 에서 파일을 불러옵니다.")

    if not pdf_path.exists():
        st.warning(f"⚠ `{pdf_path}` 파일이 존재하지 않습니다. 경로 및 파일명을 확인하세요.")
        return

    # base64 인코딩
    with pdf_path.open("rb") as f:
        base64_pdf = base64.b64encode(f.read()).decode("utf-8")

    # iframe 렌더링
    pdf_display = f"""
    <iframe src="data:application/pdf;base64,{base64_pdf}"
            width="100%" height="{height}px">
    </iframe>
    """
    st.markdown(pdf_display, unsafe_allow_html=True)


# ---------------------------------------------------------
# 🔍 한 줄 요약
# ---------------------------------------------------------
st.markdown("""
### 🔍 한 줄 요약

**숲가꾸기·조림이 집중된 침엽수 숲 + 건조한 조건**에서는  
임도와 도로를 아무리 많이 깔아도, **대형산불을 막지 못한다**는 것이  
최근 연구들의 공통된 결론입니다.
""")

st.markdown("----")

# ---------------------------------------------------------
# 🧪 연구 요약
# ---------------------------------------------------------
st.markdown("""
## 1️⃣ 무엇을 근거로 말하나?

### 🧪 연구 1. 강릉 난곡동 대형산불(2023) 사례 분석
- 피해 산림 면적: **약 149ha**
- 피해지 경계 50m 이내 도로 길이: **약 59.6km**
- 도로 밀도: **168.9 m/ha (전국 평균 대비 40배 이상)**
- 도로에 의해 분절된 숲 **83개 패치 전부 전소**
- 넓은 도로·하천·제방도 **비산(ember spotting)** 때문에 방화선 역할 실패

👉 결론: **도로망(임도 포함)이 대형산불의 확산을 막지 못했다.**


### 🧪 연구 2. 경상북도 1km 격자 산불 274건 통계 분석
- 로지스틱 회귀 결과:
  - **숲가꾸기·조림 비율 ↑ → 산불 발생 확률 ↑ (유의)**  
  - **침엽수 비율, 임분 밀도 ↑ → 위험 증가(유의)**  
  - **상대습도, 숲의 나이 ↑ → 위험 감소(유의)**  
  - **임도 접근성 → 유의하지 않음**

👉 결론: **산불은 숲가꾸기+조림 구조의 영향을 더 크게 받으며, 임도는 영향을 거의 주지 않는다.**
""")

st.markdown("----")

# ---------------------------------------------------------
# 🌿 메커니즘 요약
# ---------------------------------------------------------
st.markdown("""
## 2️⃣ 왜 이런 일이 벌어질까? (메커니즘)

### 🌿 1. 숲가꾸기 → 하층식생 제거 → 습도 감소
- 하층식생이 토양수분 유지·그늘 제공·연료분절 기능 수행
- 제거되면 햇빛·바람 지면 도달 → **급속 건조**

### 🌲 2. 침엽수 편중 + 높은 임분 밀도
- 침엽수는 가연성이 높고 수관화 위험이 큼  
- 숲가꾸기로 구조가 더 촘촘해지면 **잘 타는 숲**이 됨

### 🛣️ 3. 도로·임도의 한계
- 강풍 시 불씨가 수십~수백 m 이동  
- 도로 폭으로는 **비산을 막을 수 없음**
""")

st.markdown("----")

# ---------------------------------------------------------
# 📌 앱 구성 안내
# ---------------------------------------------------------
st.markdown("""
## 3️⃣ 이 앱에서 무엇을 볼 수 있나? 👀

1. **산불 피해 시뮬레이션 페이지**  
2. **지역별 클러스터링 페이지**

👉 왼쪽 **Pages 메뉴**에서 선택!
""")

st.markdown("---")

# ---------------------------------------------------------
# 📄 하단 PDF 열람 섹션 (최종)
# ---------------------------------------------------------
st.markdown("## 📄 참고한 연구자료 직접 보기")

col1, col2 = st.columns(2)

with col1:
    display_pdf_from_local(
        "pdf/road_fire.pdf",
        "🔍 연구 1: 산림 내 도로 확대와 대형산불"
    )

with col2:
    display_pdf_from_local(
        "pdf/forest_road_fire.pdf",
        "🌲 연구 2: 임도·산림경영과 산불 발생"
    )
