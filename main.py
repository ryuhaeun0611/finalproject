import streamlit as st
import base64
from pathlib import Path

# -------------------------------------------
# 기본 설정
# -------------------------------------------
st.set_page_config(
    page_title="숲가꾸기와 산불 피해",
    layout="wide"
)

st.title("🌲 숲가꾸기 활동이 산불 피해에 미치는 영향")

# -------------------------------------------
# 앱 제작자
# -------------------------------------------
st.markdown("""
### 👥 앱 제작자  
**동덕여자고등학교 20908 류지민 · 20909 류하은 · 20923 최보경**
""")

st.markdown("----")

# -------------------------------------------
# 한 줄 요약
# -------------------------------------------
st.markdown("""
### 🔍 한 줄 요약

최근 연구들은 **숲가꾸기·조림 활동이 오히려 산불 발생 횟수와 피해 규모를 증가시킬 수 있다**는 가능성을 보여줍니다.  
특히 **하층식생 제거 + 침엽수 위주의 촘촘한 숲 구조 + 건조 조건**이 겹치면  
산불이 더 쉽게 발생하고, 더 빠르게 확산될 수 있습니다.

""")

st.markdown("----")

# -------------------------------------------
# 연구 요약
# -------------------------------------------
st.markdown("""
## 1️⃣ 무엇을 근거로 말하나?

### 🧪 연구 1. 강릉 난곡동 대형산불(2023) 사례 분석
- 피해 산림 면적: **약 149ha**
- 피해지 경계 50m 이내 도로 길이: **약 59.6km**
- 도로 밀도: **168.9 m/ha (전국 평균 대비 40배 이상)**
- 도로에 의해 분절된 숲 **83개 패치 전부 전소**
- 넓은 도로·하천·제방도 **비산(ember spotting)** 때문에 방화선 역할 실패  
→ **도로망이 대형산불 확산을 막지 못함**

---

### 🧪 연구 2. 경상북도 1km 격자 산불 274건 통계 분석
- 숲가꾸기·조림 비율 ↑ → 산불 발생 확률 ↑ (유의)
- 침엽수 비율, 임분 밀도 ↑ → 위험 증가
- 상대습도, 숲의 나이 ↑ → 위험 감소
- 임도 접근성 → 유의하지 않음  
→ **산불은 임도보다 숲 구조의 영향을 더 크게 받음**
""")

st.markdown("----")

# -------------------------------------------
# 메커니즘 요약
# -------------------------------------------
st.markdown("""
## 2️⃣ 왜 이런 일이 벌어질까? (메커니즘)

### 🌿 1. 숲가꾸기로 하층식생이 제거됨 → 숲 내부 습도 감소
- 하층식생(활엽수·관목)은 토양 수분 유지 + 그늘 형성 + 연료 분절 기능
- 제거되면 햇빛·바람이 바로 닿아 지면 급속 건조 → **빠르게 타는 숲 구조 형성**

---

### 🌲 2. 침엽수 편중 + 높은 임분 밀도
- 침엽수는 기름 성분·낙엽 특성 때문에 가연성이 높음
- 촘촘한 수관 구조 → **수관화(수관불) 위험 증가**

---

### 🛣️ 3. 도로·임도는 큰 효과 없음
- 비산(ember)이 수십~수백 m까지 날아 도로를 쉽게 넘어감
- 통계적으로도 임도 접근성은 산불 발생과 **유의한 상관 없음**

👉 즉, **숲가꾸기가 산불 위험을 늘리는 방향으로 작용할 수 있음**
""")

st.markdown("----")

# -------------------------------------------
# 앱 구성 안내
# -------------------------------------------
st.markdown("""
## 3️⃣ 이 앱에서 볼 수 있는 것 👀

1. **다중 변수 기반 산불 피해 시뮬레이션 페이지**
2. **지역별 산불 피해 클러스터링 분석 페이지**

👉 왼쪽 **탭(Pages)** 메뉴에서 이동하세요!
""")

st.markdown("----")


# -------------------------------------------
# PDF 다운로드 기능만 제공 (iframe 제거)
# -------------------------------------------
st.markdown("## 📄 참고한 연구자료 직접 보기")

BASE_DIR = Path(__file__).parent

def pdf_download_button(rel_path: str, title: str):
    """PDF 다운로드 버튼만 제공하는 함수"""
    pdf_path = BASE_DIR / rel_path

    st.subheader(title)
    st.caption(f"`{rel_path}` 파일을 불러옵니다.")

    if not pdf_path.exists():
        st.error(f"⚠ `{rel_path}` 파일이 존재하지 않습니다.")
        return

    with pdf_path.open("rb") as f:
        pdf_bytes = f.read()

    st.download_button(
        label="📥 PDF 다운로드해서 보기",
        data=pdf_bytes,
        file_name=pdf_path.name,
        mime="application/pdf",
        key=f"download_{pdf_path.name}"
    )

col1, col2 = st.columns(2)

with col1:
    pdf_download_button(
        "pdf/산림 내 도로의 확대는 대형산불을 막을 수 있는가.pdf",
        "🔍 연구 1: 산림 내 도로 확대와 대형산불"
    )

with col2:
    pdf_download_button(
        "pdf/임도와 산림경영이 산불 발생에 미치는 영향.pdf",
        "🌲 연구 2: 임도·산림경영이 산불 발생에 미치는 영향"
    )
