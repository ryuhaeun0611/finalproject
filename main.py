import streamlit as st
import base64

st.set_page_config(
    page_title="숲가꾸기와 산불 피해",
    layout="wide"
)

st.title("🌲 숲가꾸기 활동이 산불 피해에 미치는 영향")

# ---------------------------------------------------------
# 👥 앱 제작자
# ---------------------------------------------------------
st.markdown("""
### 👥 앱 제작자  
**동덕여자고등학교 · 20908 류지민 · 20909 류하은 · 20923 최보경**
""")

st.markdown("----")

# ---------------------------------------------------------
# 💡 PDF embed 함수
# ---------------------------------------------------------
def display_pdf(file_path):
    """PDF를 base64로 인코딩하여 브라우저에 표시."""
    with open(file_path, "rb") as f:
        base64_pdf = base64.b64encode(f.read()).decode('utf-8')
    pdf_display = f'<iframe src="data:application/pdf;base64,{base64_pdf}" width="100%" height="800" type="application/pdf"></iframe>'
    st.markdown(pdf_display, unsafe_allow_html=True)

# ---------------------------------------------------------
# 🔍 한 줄 요약
# ---------------------------------------------------------
st.markdown("""
### 🔍 한 줄 요약

**숲가꾸기·조림이 집중된 침엽수 숲 + 건조한 조건**에서는  
임도와 도로를 아무리 많이 깔아도, **대형산불을 막지 못한다**는 것이  
최근 연구들의 공통된 결론입니다.
""")

st.markdown("----")

# ---------------------------------------------------------
# 🧪 연구 요약
# ---------------------------------------------------------
st.markdown("""
## 1️⃣ 무엇을 근거로 말하나?

### 🧪 연구 1. 강릉 난곡동 대형산불(2023) 사례 분석
- 피해 산림 면적: **약 149ha**
- 피해지 경계 50m 이내 도로 길이: **약 59.6km**
- 도로 밀도: **168.9 m/ha (전국 평균 대비 40배 이상)**
- 도로에 의해 분절된 숲 **83개 패치 전부 전소**
- 넓은 도로·하천·제방도 **비산(ember spotting)** 때문에 방화선 역할 실패

👉 결론: **도로망(임도 포함)이 대형산불의 확산을 막지 못했다.**

---

### 🧪 연구 2. 경상북도 1km 격자 산불 274건 통계 분석
- 산불 발생 여부를 로지스틱 회귀로 분석
- 주요 결과:
  - **숲가꾸기·조림 비율 ↑ → 산불 발생 확률 ↑ (유의)**  
  - **침엽수 비율, 임분 밀도 ↑ → 위험 증가(유의)**  
  - **상대습도, 숲의 나이 ↑ → 위험 감소(유의)**  
  - **임도 접근성 → 유의하지 않음**

👉 결론: **산불은 숲가꾸기+조림 구조의 영향을 더 크게 받으며, 임도는 영향을 거의 주지 않는다.**
""")

st.markdown("----")

# ---------------------------------------------------------
# 🌿 메커니즘 요약
# ---------------------------------------------------------
st.markdown("""
## 2️⃣ 왜 이런 일이 벌어질까? (메커니즘)

### 🌿 1. 숲가꾸기 → 하층식생 제거 → 습도 감소
- 원래 하층식생(관목·활엽수)은 **토양 수분 유지 + 그늘형성 + 연료분절** 기능
- 숲가꾸기로 제거되면:
  - 햇빛·바람이 지면에 직격 → **급속 건조**
  - 연료가 균질해져 **발화·확산 쉬움**

### 🌲 2. 침엽수 편중 + 높은 임분 밀도
- 침엽수는 기름 성분·낙엽 특성 때문에 **가연성 높음**
- 임목 간격이 촘촘하면 수관-수관 연속성 ↑ → **수관화 위험 증가**

### 🛣️ 3. 도로·임도 확대의 한계
- 도로 폭으로는 **비산(ember spotting)을 막을 수 없음**
- 도로 접근성은 분석 결과 **산불 피해·발생과 유의한 관계 없음**

""")

st.markdown("----")

# ---------------------------------------------------------
# 📌 앱 구성 안내
# ---------------------------------------------------------
st.markdown("""
## 3️⃣ 이 앱에서 무엇을 볼 수 있나? 👀

1. **[산불 피해 시뮬레이션]**  
   - 숲가꾸기, 침엽수 비율, 임분 밀도, 습도 등이  
     피해 면적에 미치는 **방향성**을 시각적으로 확인.

2. **[지역별 클러스터링]**  
   - 전처리된 `region_df.csv`를 업로드하면  
     지역의 산불 구조를 **유클리드 거리 기반 클러스터**로 분석.

👉 왼쪽 **Pages 메뉴**에서 다른 페이지를 선택하세요!
""")

st.markdown("----")

import base64
from pathlib import Path
import streamlit as st

# ... (위에는 기존 제목/내용 코드가 있다고 가정) ...


# ==============================
# 📄 하단: PDF 직접 열람 섹션
# ==============================
st.markdown("---")
st.markdown("## 📄 참고한 연구자료 직접 보기")

BASE_DIR = Path(__file__).parent  # main.py가 있는 폴더 기준

def display_pdf_from_local(rel_path: str, title: str, height: int = 500):
    """리포지토리 내부 PDF를 iframe으로 띄우는 함수"""
    pdf_path = BASE_DIR / rel_path

    st.subheader(title)
    st.caption(f"`{rel_path}` 위치에서 불러옵니다.")

    if not pdf_path.exists():
        st.warning(f"⚠ `{pdf_path}` 파일을 찾을 수 없습니다. 경로와 파일명을 다시 확인해 주세요.")
        return

    with pdf_path.open("rb") as f:
        base64_pdf = base64.b64encode(f.read()).decode("utf-8")

    pdf_display = f"""
    <iframe
        src="data:application/pdf;base64,{base64_pdf}"
        width="100%"
        height="{height}px"
        type="application/pdf">
    </iframe>
    """
    st.markdown(pdf_display, unsafe_allow_html=True)


col1, col2 = st.columns(2)

with col1:
    display_pdf_from_local(
        "pdf/road_fire.pdf",
        "🔍 연구 1: 산림 내 도로 확대와 대형산불"
    )

with col2:
    display_pdf_from_local(
        "pdf/forest_road_fire.pdf",
        "🌲 연구 2: 임도·산림경영과 산불 발생"
    )
